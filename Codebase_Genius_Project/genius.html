<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>üìò Codebase Genius ‚Äì Repo Documentation Generator</title>

    <!-- Bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Markdown Renderer -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- Optional: Syntax Highlighting -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>

    <style>
      body {
        background-color: #0f172a;
        color: #e2e8f0;
        font-family: "Inter", sans-serif;
        padding: 2rem;
      }

      h1 {
        color: #38bdf8;
        font-weight: 700;
      }

      pre {
        background: #1e293b;
        color: #cbd5e1;
        padding: 1rem;
        border-radius: 10px;
        overflow-x: auto;
      }

      code {
        color: #93c5fd;
      }

      .btn-primary {
        background-color: #3b82f6;
        border: none;
        border-radius: 8px;
        font-weight: 600;
      }

      .btn-primary:hover {
        background-color: #2563eb;
      }

      .output-box {
        background-color: #1e293b;
        padding: 2rem;
        border-radius: 12px;
        margin-top: 2rem;
        line-height: 1.6;
      }

      .text-secondary {
        color: #94a3b8 !important;
      }
    </style>
  </head>

  <body>
    <div class="container">
      <h1>üöÄ Codebase Genius ‚Äì Repo Documentation Generator</h1>
      <p class="text-secondary">
        Enter a GitHub repository URL to automatically generate rich documentation using Jaseci agents.
      </p>

      <div class="mb-3">
        <input
          type="text"
          id="repoUrl"
          class="form-control"
          placeholder="e.g. https://github.com/..."
        />
      </div>
      <button id="generateBtn" class="btn btn-primary">Generate Documentation</button>

      <div id="output" class="output-box mt-4"></div>
    </div>

    <script>
      document.getElementById("generateBtn").addEventListener("click", async () => {
        const repoUrl = document.getElementById("repoUrl").value.trim();
        const outputDiv = document.getElementById("output");

        if (!repoUrl) {
          outputDiv.innerHTML = `<p class="text-danger">‚ö†Ô∏è Please enter a repository URL.</p>`;
          return;
        }

        outputDiv.innerHTML = `<p>‚è≥ Generating documentation for <b>${repoUrl}</b> ...</p>`;

        try {
          const response = await fetch("http://localhost:8000/walker/GenerateRepoDoc", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ repo_url: repoUrl }),
          });

          const data = await response.json();
          const markdown = data.reports?.join("\n") || "No documentation generated.";

          // Render the Markdown beautifully
          const htmlContent = marked.parse(markdown);
          outputDiv.innerHTML = htmlContent;

          // Apply code highlighting
          document.querySelectorAll("pre code").forEach((block) => {
            hljs.highlightElement(block);
          });
        } catch (error) {
          console.error(error);
          outputDiv.innerHTML = `<p class="text-danger">‚ùå Error: ${error.message}</p>`;
        }
      });
    </script>
  </body>
</html>
